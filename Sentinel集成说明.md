# Sentinel é›†æˆè¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®å·²é›†æˆ Sentinel æµé‡æ§åˆ¶ç»„ä»¶ï¼Œæä¾›äº†å®Œæ•´çš„æµæ§ã€ç†”æ–­ã€é™çº§åŠŸèƒ½æ¼”ç¤ºã€‚

## ğŸ”§ é…ç½®è¯´æ˜

### 1. ä¾èµ–é…ç½®

å·²åœ¨ `pom.xml` ä¸­æ·»åŠ ï¼š
```xml
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>
</dependency>
```

### 2. åº”ç”¨é…ç½®

åœ¨ `application.yml` ä¸­é…ç½®äº† Sentinel Dashboard è¿æ¥ï¼š

```yaml
spring:
  cloud:
    sentinel:
      transport:
        dashboard: localhost:8718  # Sentinel Dashboard åœ°å€
        port: 8719                 # å®¢æˆ·ç«¯ç›‘æ§ API ç«¯å£
      eager: true                  # ç«‹å³åˆå§‹åŒ–
```

### 3. Sentinel Dashboard

ç¡®ä¿æœ¬åœ° Sentinel Dashboard å·²å¯åŠ¨ï¼š
- è®¿é—®åœ°å€ï¼šhttp://localhost:8718
- é»˜è®¤è´¦å·ï¼šsentinel
- é»˜è®¤å¯†ç ï¼šsentinel

## ğŸš€ æ¼”ç¤ºæ¥å£

### 1. æµæ§æ¼”ç¤º - QPS é™æµ

**æ¥å£**: `GET /api/sentinel/flow`

**è¯´æ˜**: æ¼”ç¤º QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰æµæ§

**é…ç½®è§„åˆ™**:
1. åœ¨ Sentinel Dashboard ä¸­ï¼Œè¿›å…¥"æµæ§è§„åˆ™"
2. ç‚¹å‡»"æ–°å¢æµæ§è§„åˆ™"
3. èµ„æºåï¼š`flowControl`
4. é˜ˆå€¼ç±»å‹ï¼šQPS
5. å•æœºé˜ˆå€¼ï¼š2ï¼ˆæ¯ç§’æœ€å¤š 2 ä¸ªè¯·æ±‚ï¼‰
6. ç‚¹å‡»"æ–°å¢"

**æµ‹è¯•**:
```bash
# å¿«é€Ÿè¿ç»­è¯·æ±‚ï¼Œè¶…è¿‡é˜ˆå€¼åä¼šè¢«é™æµ
curl http://localhost:8080/api/sentinel/flow
```

### 2. ç†”æ–­æ¼”ç¤º - å¼‚å¸¸æ¯”ä¾‹ç†”æ–­

**æ¥å£**: `GET /api/sentinel/circuit?error=true`

**è¯´æ˜**: æ¼”ç¤ºå¼‚å¸¸æ¯”ä¾‹ç†”æ–­

**é…ç½®è§„åˆ™**:
1. åœ¨ Sentinel Dashboard ä¸­ï¼Œè¿›å…¥"ç†”æ–­è§„åˆ™"
2. ç‚¹å‡»"æ–°å¢ç†”æ–­è§„åˆ™"
3. èµ„æºåï¼š`circuitBreaker`
4. ç†”æ–­ç­–ç•¥ï¼šå¼‚å¸¸æ¯”ä¾‹
5. å¼‚å¸¸æ¯”ä¾‹é˜ˆå€¼ï¼š0.5ï¼ˆ50%ï¼‰
6. æœ€å°è¯·æ±‚æ•°ï¼š5
7. ç†”æ–­æ—¶é•¿ï¼š10 ç§’
8. ç‚¹å‡»"æ–°å¢"

**æµ‹è¯•**:
```bash
# è¿ç»­è¯·æ±‚ 5 æ¬¡ï¼Œå…¶ä¸­ 3 æ¬¡å¸¦ error=true å‚æ•°
for i in {1..5}; do
  if [ $i -le 3 ]; then
    curl "http://localhost:8080/api/sentinel/circuit?error=true"
  else
    curl "http://localhost:8080/api/sentinel/circuit?error=false"
  fi
done
```

### 3. çº¿ç¨‹æ•°æµæ§æ¼”ç¤º

**æ¥å£**: `GET /api/sentinel/thread`

**è¯´æ˜**: æ¼”ç¤ºçº¿ç¨‹æ•°æµæ§ï¼ˆå¹¶å‘çº¿ç¨‹æ•°é™åˆ¶ï¼‰

**é…ç½®è§„åˆ™**:
1. åœ¨ Sentinel Dashboard ä¸­ï¼Œè¿›å…¥"æµæ§è§„åˆ™"
2. ç‚¹å‡»"æ–°å¢æµæ§è§„åˆ™"
3. èµ„æºåï¼š`threadControl`
4. é˜ˆå€¼ç±»å‹ï¼šçº¿ç¨‹æ•°
5. å•æœºé˜ˆå€¼ï¼š2ï¼ˆæœ€å¤š 2 ä¸ªå¹¶å‘çº¿ç¨‹ï¼‰
6. ç‚¹å‡»"æ–°å¢"

**æµ‹è¯•**:
```bash
# å¹¶å‘è¯·æ±‚ï¼Œè¶…è¿‡çº¿ç¨‹æ•°é˜ˆå€¼åä¼šè¢«é™æµ
for i in {1..5}; do
  curl http://localhost:8080/api/sentinel/thread &
done
wait
```

### 4. çƒ­ç‚¹å‚æ•°é™æµæ¼”ç¤º

**æ¥å£**: `GET /api/sentinel/hot?param=test`

**è¯´æ˜**: æ¼”ç¤ºçƒ­ç‚¹å‚æ•°é™æµ

**é…ç½®è§„åˆ™**:
1. åœ¨ Sentinel Dashboard ä¸­ï¼Œè¿›å…¥"çƒ­ç‚¹è§„åˆ™"
2. ç‚¹å‡»"æ–°å¢çƒ­ç‚¹è§„åˆ™"
3. èµ„æºåï¼š`hotParam`
4. å‚æ•°ç´¢å¼•ï¼š0ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰
5. å•æœºé˜ˆå€¼ï¼š2
6. ç‚¹å‡»"æ–°å¢"

**æµ‹è¯•**:
```bash
# ä½¿ç”¨ç›¸åŒå‚æ•°å¿«é€Ÿè¯·æ±‚
for i in {1..5}; do
  curl "http://localhost:8080/api/sentinel/hot?param=test"
done
```

### 5. ç³»ç»Ÿè‡ªé€‚åº”é™æµæ¼”ç¤º

**æ¥å£**: `GET /api/sentinel/system`

**è¯´æ˜**: æ¼”ç¤ºç³»ç»Ÿè‡ªé€‚åº”é™æµ

**é…ç½®è§„åˆ™**:
1. åœ¨ Sentinel Dashboard ä¸­ï¼Œè¿›å…¥"ç³»ç»Ÿè§„åˆ™"
2. ç‚¹å‡»"æ–°å¢ç³»ç»Ÿè§„åˆ™"
3. é˜ˆå€¼ç±»å‹ï¼šç³»ç»Ÿè´Ÿè½½
4. é˜ˆå€¼ï¼š0.8ï¼ˆç³»ç»Ÿè´Ÿè½½è¶…è¿‡ 0.8 æ—¶è§¦å‘ï¼‰
5. ç‚¹å‡»"æ–°å¢"

**æµ‹è¯•**:
```bash
curl http://localhost:8080/api/sentinel/system
```

### 6. è·å–æ¥å£ä¿¡æ¯

**æ¥å£**: `GET /api/sentinel/info`

**è¯´æ˜**: è·å–æ‰€æœ‰ Sentinel æ¼”ç¤ºæ¥å£çš„è¯´æ˜

**æµ‹è¯•**:
```bash
curl http://localhost:8080/api/sentinel/info
```

## ğŸ“Š ç›‘æ§å’ŒæŸ¥çœ‹

### 1. å®æ—¶ç›‘æ§

åœ¨ Sentinel Dashboard ä¸­ï¼š
- **å®æ—¶ç›‘æ§**: æŸ¥çœ‹å®æ—¶ QPSã€å“åº”æ—¶é—´ç­‰æŒ‡æ ‡
- **ç°‡ç‚¹é“¾è·¯**: æŸ¥çœ‹æ‰€æœ‰èµ„æºçš„è°ƒç”¨æƒ…å†µ
- **è§„åˆ™ç®¡ç†**: é…ç½®å’Œç®¡ç†å„ç§è§„åˆ™

### 2. è§„åˆ™ç±»å‹

- **æµæ§è§„åˆ™**: æ§åˆ¶ QPS æˆ–çº¿ç¨‹æ•°
- **ç†”æ–­è§„åˆ™**: å¼‚å¸¸æ¯”ä¾‹ã€å¼‚å¸¸æ•°ã€æ…¢è°ƒç”¨æ¯”ä¾‹
- **çƒ­ç‚¹è§„åˆ™**: é’ˆå¯¹çƒ­ç‚¹å‚æ•°é™æµ
- **ç³»ç»Ÿè§„åˆ™**: ç³»ç»Ÿè‡ªé€‚åº”é™æµ
- **æˆæƒè§„åˆ™**: é»‘ç™½åå•æ§åˆ¶

## ğŸ” å¸¸è§é—®é¢˜

### 1. è§„åˆ™ä¸ç”Ÿæ•ˆ

- æ£€æŸ¥ Sentinel Dashboard æ˜¯å¦æ­£å¸¸è¿è¡Œ
- æ£€æŸ¥åº”ç”¨é…ç½®ä¸­çš„ Dashboard åœ°å€æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥èµ„æºåç§°æ˜¯å¦åŒ¹é…

### 2. çœ‹ä¸åˆ°å®æ—¶ç›‘æ§æ•°æ®

- ç¡®ä¿åº”ç”¨å·²å¯åŠ¨å¹¶å‘é€å¿ƒè·³
- æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
- æŸ¥çœ‹åº”ç”¨æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯

### 3. é™çº§æ–¹æ³•ä¸æ‰§è¡Œ

- æ£€æŸ¥ `@SentinelResource` æ³¨è§£é…ç½®æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥ `blockHandler` æˆ– `fallback` æ–¹æ³•ç­¾åæ˜¯å¦åŒ¹é…
- æŸ¥çœ‹åº”ç”¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

## ğŸ“ ä»£ç è¯´æ˜

### 1. SentinelDemoController

æä¾›äº† 5 ç§ Sentinel åŠŸèƒ½çš„æ¼”ç¤ºï¼š
- QPS æµæ§
- å¼‚å¸¸æ¯”ä¾‹ç†”æ–­
- çº¿ç¨‹æ•°æµæ§
- çƒ­ç‚¹å‚æ•°é™æµ
- ç³»ç»Ÿè‡ªé€‚åº”é™æµ

### 2. SentinelConfig

é…ç½®ç±»ï¼Œå¯ä»¥åœ¨è¿™é‡Œè®¾ç½®é»˜è®¤çš„æµæ§è§„åˆ™ï¼ˆå¯é€‰ï¼‰ã€‚

## ğŸ¯ ä½¿ç”¨å»ºè®®

1. **å¼€å‘ç¯å¢ƒ**: ä½¿ç”¨ Sentinel Dashboard åŠ¨æ€é…ç½®è§„åˆ™ï¼Œæ–¹ä¾¿æµ‹è¯•
2. **ç”Ÿäº§ç¯å¢ƒ**: å»ºè®®é€šè¿‡é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacosï¼‰æŒä¹…åŒ–è§„åˆ™
3. **ç›‘æ§å‘Šè­¦**: é…ç½®å‘Šè­¦è§„åˆ™ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
4. **è§„åˆ™è°ƒä¼˜**: æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯è°ƒæ•´é˜ˆå€¼

## ğŸ”— ç›¸å…³èµ„æº

- [Sentinel å®˜æ–¹æ–‡æ¡£](https://sentinelguard.io/zh-cn/)
- [Spring Cloud Alibaba Sentinel](https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel)
- [Sentinel Dashboard éƒ¨ç½²](https://github.com/dds521/sentinel-docker)

---

**æç¤º**: æ‰€æœ‰è§„åˆ™éƒ½å¯ä»¥é€šè¿‡ Sentinel Dashboard åŠ¨æ€é…ç½®ï¼Œæ— éœ€é‡å¯åº”ç”¨ã€‚
